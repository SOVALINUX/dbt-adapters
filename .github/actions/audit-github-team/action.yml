name: "Audit GitHub team"
description: "Get metadata about a GitHub team"

inputs:
  organization:
    description: "The GitHub organization that owns the team"
    default: "dbt-labs"
  team:
    description: "The name of the team"
    required: true

outputs:
  members:
    description: "A space delimited list of team members"
    value: ${{ steps.members.outputs.membership }}

runs:
  using: composite
  steps:
    - name: "[DEBUG] Inputs"
      shell: bash
      run: |
        echo organization : ${{ inputs.organization }}
        echo team         : ${{ inputs.team }}

    - name: "Create output file name"
      id: output-file
      shell: bash
      run: echo "name=output_$GITHUB_RUN_ID.json" >> $GITHUB_OUTPUT

    - name: "Get team membership"
      shell: bash
      run: |
        url = orgs/${{ inputs.organization }}/teams/${{ inputs.team }}/members
        header = Accept: application/vnd.github+json
        gh api -H "$header" $url > ${{ steps.output-file.outputs.name }}

    - name: "Parse team membership"
      id: members
      shell: bash
      run: |
        team_list=$(jq -r '.[].login' ${{ steps.output-file.outputs.name }})
        team_list_single=$(echo $team_list | tr '\n' ' ')
        echo "membership=$team_list_single" >> $GITHUB_OUTPUT

    - name: "Delete the output file"
      shell: bash
      run: rm ${{ steps.output-file.outputs.name }}

    - name: "[DEBUG] Parse team membership"
      shell: bash
      run: |
        echo organization : ${{ inputs.organization }}
        echo team         : ${{ inputs.team }}
        echo members      : ${{ steps.members.outputs.membership }}
